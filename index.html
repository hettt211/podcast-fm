<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap'); /* 引入现代字体 */

        :root {
            --primary-color: #8e44ad; /* 主题色 - 紫色 */
            --primary-light: #a569bd; /* 浅紫色 */
            --primary-dark: #703688; /* 深紫色 */
            --secondary-color: #9b59b6; /* 次要色 - 淡紫色 */
            --background-color: #f5f5f7; /* 背景色 - 浅灰偏白 */
            --surface-color: #ffffff; /* 元素表面色 - 白色 */
            --text-color: #333333; /* 主要文本色 - 深灰 */
            --text-muted-color: #777777; /* 次要文本色 - 灰色 */
            --border-color: #e0e0e0; /* 边框色 - 浅灰 */
            --hover-bg-color: #f0f0f2; /* 悬停背景色 */
            --button-hover-bg: #7d3c98; /* 按钮悬停背景色 */
            --box-shadow: 0 4px 20px rgba(142, 68, 173, 0.1); /* 紫色调阴影 */
            --border-radius: 12px; /* 更大的圆角 */
            --transition-speed: 0.3s; /* 统一过渡动画速度 */
        }

        body {
            font-family: 'Inter', sans-serif; /* 应用新字体 */
            margin: 0;
            padding: 0; /* 移除页面边距 */
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        .container {
            max-width: 100%;
            margin: auto;
            background: var(--surface-color);
            padding: 20px; /* 减少容器内边距 */
            border-radius: 0; /* 移除顶部圆角 */
            box-shadow: var(--box-shadow);
        }
        
        /* 顶部问候栏样式 */
        .greeting-bar {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: white;
            padding: 15px 20px;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            margin: -20px -20px 20px -20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .greeting-text {
            font-size: 1.1rem;
            font-weight: 500;
        }
        .current-time {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        /* 滑块选择器样式 */
        .slider-container {
            margin-bottom: 25px;
            position: relative;
        }
        .slider-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--primary-color);
        }
        .range-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--border-color);
            outline: none;
            margin-bottom: 10px;
        }
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            transition: all var(--transition-speed);
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
            z-index: 2;
        }
        .range-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            background: var(--primary-dark);
            box-shadow: 0 0 10px rgba(142, 68, 173, 0.4);
        }
        /* 滑块节点标记样式 */
        .slider-ticks {
            display: flex;
            justify-content: space-between;
            padding: 0 10px;
            margin-top: -5px;
        }
        .slider-tick {
            position: relative;
            width: 2px;
            height: 10px;
            background: var(--primary-color);
            opacity: 0.7;
        }
        .slider-tick-label {
            position: absolute;
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75rem;
            color: var(--text-muted-color);
            white-space: nowrap;
        }
        .slider-tick.major {
            height: 14px;
            width: 3px;
            background: var(--primary-color);
            opacity: 0.9;
        }
        .slider-value {
            text-align: center;
            font-weight: 500;
            color: var(--primary-color);
        }
        h1 {
            color: var(--text-color);
            text-align: center;
            margin-bottom: 40px; /* 增加标题下边距 */
            font-weight: 700;
        }
        h2, h3, h4 {
            color: var(--text-color);
            margin-top: 0;
            font-weight: 500;
        }
        .module {
            margin-bottom: 35px; /* 增加模块间距 */
            padding: 20px; /* 增加模块内边距 */
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: var(--surface-color); /* 模块背景 */
        }
        .module {
            position: relative; /* 为绝对定位的按钮提供容器 */
        }
        .module h3 {
            color: var(--primary-color); /* 模块标题使用主题色 */
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 20px; /* 增加标题下边距 */
        }
        label {
            display: block;
            margin-bottom: 8px; /* 增加标签下边距 */
            font-weight: 500;
            color: var(--text-muted-color);
        }
        input[type="number"] {
            width: 120px; /* 稍微加宽 */
            padding: 10px 12px; /* 增加内边距 */
            margin-bottom: 15px; /* 增加下边距 */
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            box-sizing: border-box; /* 确保 padding 不影响宽度 */
        }
        input[type="number"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }
        button {
            padding: 10px 20px; /* 调整按钮内边距 */
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            margin-right: 8px;
            font-size: 0.95rem;
            transition: all var(--transition-speed);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        button:hover {
            background-color: var(--button-hover-bg);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        button:active {
            transform: translateY(0);
        }
        button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%, -50%);
            transform-origin: 50% 50%;
        }
        button:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }
        /* 次要按钮样式 (例如移除按钮) */
        button.secondary {
            background-color: var(--surface-color);
            color: var(--secondary-color);
            border: 1px solid var(--border-color);
        }
        button.secondary:hover {
            background-color: var(--hover-bg-color);
            border-color: var(--secondary-color);
        }

        #recommendation-result ul, #playlist ul, #recently-listened ul {
            list-style: none;
            padding: 0;
            margin-top: 15px; /* 列表与上方元素间距 */
        }
        #recommendation-result li, #playlist li, #recently-listened li {
            background: var(--surface-color);
            margin-bottom: 12px; /* 列表项间距 */
            padding: 15px; /* 列表项内边距 */
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all var(--transition-speed);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        #recommendation-result li:hover, #playlist li:hover, #recently-listened li:hover {
            background-color: var(--hover-bg-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-color: var(--primary-light);
        }
        /* 已经在上面的样式中更新了这部分 */
        /* 播客封面图片样式 */
        .podcast-thumbnail {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            margin-right: 15px;
            object-fit: cover;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all var(--transition-speed);
        }
        .podcast-thumbnail:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .podcast-info {
            flex-grow: 1;
            margin-right: 15px; /* 信息与按钮间距 */
            min-width: 0; /* 防止内容溢出时挤压其他元素 */
        }
        .podcast-title {
            font-weight: 500; /* 调整字重 */
            color: var(--text-color);
            display: block; /* 让标题独占一行 */
            margin-bottom: 4px;
        }
        .podcast-duration {
            color: var(--text-muted-color);
            font-size: 0.85em;
        }
        .listen-progress {
            font-size: 0.85em;
            color: var(--primary-color);
            margin-top: 5px;
        }
        .summary {
            font-size: 0.8em;
            color: var(--text-muted-color);
            margin-top: 8px;
            line-height: 1.4;
            /* 新增：处理长文本溢出 */
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap; 
            display: block; /* 确保块级上下文 */
        }
        .summary b {
            color: var(--text-color);
            font-weight: 500;
        }

        /* 播客列表项中的操作按钮容器 */
        .podcast-actions {
            display: flex;
            align-items: center;
            gap: 8px; /* 按钮间距 */
            margin-left: auto; /* 将按钮推到右侧 */
            flex-shrink: 0; /* 防止按钮容器被压缩 */
        }
        /* 调整列表项按钮大小和样式 (推荐列表和播放列表通用) */
        .podcast-actions .control-button,
        #playlist li .control-button /* 特定于播放列表按钮 */
         {
            width: 36px;
            height: 36px;
            font-size: 0.9rem;
            background: rgba(142, 68, 173, 0.08); /* 淡紫色背景 */
            color: var(--primary-dark);
            box-shadow: none;
            margin: 0;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all var(--transition-speed);
            display: inline-flex; /* 使图标居中 */
            justify-content: center;
            align-items: center;
        }
        .podcast-actions .control-button:hover,
        #playlist li .control-button:hover {
            background: rgba(142, 68, 173, 0.15); /* 悬停时加深 */
            color: var(--primary-color);
            transform: scale(1.1);
        }
        /* 播放中或已添加状态 */
        .podcast-actions .control-button.playing,
        .podcast-actions .control-button.added {
            background: var(--primary-light);
            color: white;
        }
        .podcast-actions .control-button.playing:hover,
        .podcast-actions .control-button.added:hover {
            background: var(--primary-color);
        }
        /* 播放列表中的移除按钮特定样式 */
        #playlist li .control-button.secondary {
             background-color: rgba(0, 0, 0, 0.05);
             color: var(--text-muted-color);
        }
         #playlist li .control-button.secondary:hover {
             background-color: rgba(0, 0, 0, 0.1);
             color: var(--secondary-color); /* 悬停时用次要色 */
         }
        /* 隐藏推荐确认按钮的初始样式 */
        #confirm-recommendation {
             margin-top: 15px; /* 与列表的间距 */
        }
        /* 换一批按钮样式调整 */
        .refresh-button {
            position: absolute;
            top: 15px; /* 调整垂直位置 */
            right: 20px; /* 调整水平位置 */
            background-color: transparent;
            color: var(--text-muted-color);
            border: 1px solid var(--border-color);
            padding: 5px 10px;
            font-size: 0.85rem;
            box-shadow: none;
        }
        .refresh-button:hover {
            background-color: var(--hover-bg-color);
            color: var(--primary-color);
            border-color: var(--primary-light);
            transform: none; /* 移除悬停时的位移 */
            box-shadow: none;
        }
        .refresh-button i {
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 顶部问候栏 -->
        <div class="greeting-bar">
            <div class="greeting-text" id="greeting">下午好！选择你的收听时长，开启定制推荐</div>
            <div class="current-time" id="current-time">15:30</div>
        </div>
        
      <!-- 收听时长滑块 -->
      <div class="slider-container">
        <label class="slider-label" for="listen-duration-slider">预计收听时长: <span id="duration-value">60</span> 分钟</label>
        <input type="range" class="range-slider" id="listen-duration-slider" min="0" max="120" value="60" step="5">
        <div class="slider-ticks">
            <div class="slider-tick major"><div class="slider-tick-label">0</div></div>
            <div class="slider-tick"></div>
            <div class="slider-tick"></div>
            <div class="slider-tick"></div>
            <div class="slider-tick"></div>
            <div class="slider-tick"></div>
            <div class="slider-tick major"><div class="slider-tick-label">30</div></div>
            <div class="slider-tick"></div>
            <div class="slider-tick"></div>
            <div class="slider-tick"></div>
            <div class="slider-tick"></div>
            <div class="slider-tick"></div>
            <div class="slider-tick major"><div class="slider-tick-label">60</div></div>
            <div class="slider-tick"></div>
            <div class="slider-tick"></div>
            <div class="slider-tick"></div>
            <div class="slider-tick"></div>
            <div class="slider-tick"></div>
            <div class="slider-tick major"><div class="slider-tick-label">90</div></div>
            <div class="slider-tick"></div>
            <div class="slider-tick"></div>
            <div class="slider-tick"></div>
            <div class="slider-tick"></div>
            <div class="slider-tick"></div>
            <div class="slider-tick major"><div class="slider-tick-label">120</div></div>
        </div>
    </div>

    <!-- 开启推荐按钮 -->
    <div style="text-align: center; margin-bottom: 25px;">
        <button id="start-recommendation-button" onclick="getRecommendations(true)">开启推荐</button>
    </div>

    <!-- 个性化推荐模块 -->
    <div class="module">
        <h3>随心听FM <i class="fas fa-magic"></i></h3>
        <button onclick="getRecommendations()" class="refresh-button"><i class="fas fa-sync-alt"></i> 换一批</button>
        
        <div id="recommendation-result">
            <ul>
                <!-- 推荐结果将显示在这里 -->
            </ul>
            <!-- 全局加入待播按钮已被移除 -->
        </div>
    </div>

        
       

    <script>
        // 获取播客封面图片路径
        function getPodcastCoverPath(author) {
            // 根据作者名称获取对应的图片路径
            // 如果找不到匹配的图片，则返回默认图片
            const defaultCover = 'https://via.placeholder.com/60x60/8e44ad/ffffff?text=' + encodeURIComponent(author.charAt(0));
            
            // 检查是否有对应的图片
            const authorImgMap = {
                '李诞': 'image/李诞.jpg',
                '声动早咖啡': 'image/声动早咖啡.jpg',
                '商业就是这样': 'image/商业就是这样.jpg',
                '天真不天真': 'image/天真不天真.jpg',
                '生活杂志': 'image/生活杂志.jpg',
                '原来是这样？！': 'image/原来是这样？！.jpg',
                '地理狗看世界': 'image/地理狗看世界.jpg',
                '文化有限': 'image/文化有限.jpg',
                '知行小酒馆': 'image/知行小酒馆.jpg',
                '36氪·8点1氪': 'image/8点1氪.jpg',
                '不把天聊si': 'image/不把天聊si.jpg',
                '奇想驿': 'image/奇想驿.jpg',
                '张小珺': 'image/张小珺.jpg',
                '故事FM': 'image/故事FM.jpg',
                '电影不无聊': 'image/电影不无聊.jpg',
                '随机波动': 'image/随机波动.jpg'
            };
            
            return authorImgMap[author] || defaultCover;
        }
        
        // 模拟播客数据
        const allPodcasts = [
            { id: 1, author:"李诞", title: "20.违心时刻", duration: 43, description: "你的关注" },
            { id: 2, author:"博物志", title: "235.扬州观想（上）", duration: 98, description: "你的关注" },
            { id: 3, author:"声动早咖啡", title: "情绪劳动成职场隐形KPI，打工人怎样才能减少内耗？", duration: 16, description: "今日更新" },
            { id: 4, author:"歪波音乐室", title: "4月新歌推荐 | 陶喆、黄宣、Lorde、打雷姐…初夏来临！", duration: 81, description: "你的关注" },
            { id: 5, author:"张小珺", title: "对Manus创始人肖弘的3小时访谈：世界不是线性外推，做博弈中的重要变量", duration: 202, description: "近期热门" },
            { id: 6, author:"商业就是这样", title: "商业小样25 | 一次性搞懂AUDI和奥迪的关系", duration: 12, description: "今日更新" },
            { id: 7, author:"奇想驿", title: "在flomo 5周年时，聊聊那些真实的思考痕迹", duration: 27, description: "你的关注" },
            { id: 8, author:"随机波动", title: "【随机波动158】与严艺家聊《混沌少年时》：当男孩杀人，当师姐发疯", duration: 87, description: "精近期热门" },
            { id: 9, author:"天真不天真", title: "vol.26 我的新进化：在运动中找回生命主体性", duration: 68, description: "近期热门" },
            { id: 10, author:"不把天聊si", title: "vol.197 | 逐渐变老的生活里，如何创造年轻感？", duration: 47, description: "今日更新" },
            { id: 11, author:"喜番调频|笑个不停", title: "我的高光（中光、低光、微光）时刻", duration: 81, description: "笑话脱口秀" },
            { id: 12, author:"给女孩的商业第一课", title: "【润宇返场】怒聊4小时！教会女孩如何启动小生意", duration: 179, description: "你的关注" },
            { id: 13, author:"看理想圆桌", title: "观鸟做饭写日记，在一个不守承诺的世界自我托举", duration: 76, description: "你的关注" },
            { id: 14, author:"生活杂志", title: "腐竹，热量比猪大肠还高！很多人却还在把它当减脂餐", duration: 8, description: "生活杂谈" },
            { id: 15, author:"电影不无聊", title: "vol.501 2025年5月观影指南", duration: 73, description: "今日更新" },
            { id: 16, author:"行动派精选文章", title: "高配人生，不是“拼出来”的", duration: 12, description: "个人成长" },
            { id: 17, author:"知行小酒馆", title: "E184 当关税站改变世界：我们要怎样理解未来的生活、投资以及经济秩序？", duration: 78, description: "近期热门" },
            { id: 18, author:"原来是这样？！", title: "我们为什么会哺乳？", duration: 50, description: "科学通识" },
            { id: 19, author:"地理狗看世界", title: "济州岛，苦尽甘柑来", duration: 9, description: "世界风情" },
            { id: 20, author:"文化有限", title: "夏洛的网：总会有人为你写下“你很棒”", duration: 96, description: "近期热门" },
            { id: 21, author:"36氪·8点1氪", title: "一季度全国黄金消费量290.492吨", duration: 3, description: "今日更新" },
            { id: 22, author:"商业就是这样", title: "vol.205 我们研究了奥乐齐中国所有的商品，它到底便宜吗", duration: 45, description: "你的关注" }
        ];

    

        let currentRecommendation = [];
        let playlist = [];

        // 获取推荐组合
        function getRecommendations() {
            const targetDuration = parseInt(document.getElementById('duration-value').textContent);
            const resultList = document.getElementById('recommendation-result').querySelector('ul');
            const confirmButton = document.getElementById('confirm-recommendation');
            resultList.innerHTML = ''; // 清空旧推荐
            currentRecommendation = [];
            
            // 添加加载动画
            resultList.innerHTML = '<li style="justify-content: center;"><i class="fas fa-spinner fa-spin" style="margin-right: 10px;"></i> 正在为您推荐...</li>';
            
            // 模拟网络延迟
            setTimeout(() => {
                resultList.innerHTML = '';
                
                if (isNaN(targetDuration) || targetDuration <= 0) {
                    resultList.innerHTML = '<li>请输入有效的时长。</li>';
                    confirmButton.style.display = 'none';
                    return;
                }

            // 简单的推荐逻辑：找到时长最接近的单个或两个节目组合
            // 优先单个节目
            let bestSingleMatch = null;
            let minSingleDiff = Infinity;

            allPodcasts.forEach(p => {
                const diff = Math.abs(p.duration - targetDuration);
                if (diff < minSingleDiff) {
                    minSingleDiff = diff;
                    bestSingleMatch = p;
                }
            });

            // 尝试两个节目组合
            let bestPairMatch = [];
            let minPairDiff = Infinity;

            for (let i = 0; i < allPodcasts.length; i++) {
                for (let j = i + 1; j < allPodcasts.length; j++) {
                    const pairDuration = allPodcasts[i].duration + allPodcasts[j].duration;
                    const diff = Math.abs(pairDuration - targetDuration);
                    if (diff < minPairDiff) {
                        minPairDiff = diff;
                        bestPairMatch = [allPodcasts[i], allPodcasts[j]];
                    }
                }
            }

            // 比较单节目和双节目组合哪个更优 (优先时长更接近的)
            if (bestSingleMatch && minSingleDiff <= minPairDiff + 5) { // 给单节目一点容忍度
                 currentRecommendation = [bestSingleMatch];
            } else if (bestPairMatch.length > 0) {
                 currentRecommendation = bestPairMatch;
            }

            if (currentRecommendation.length > 0) {
                currentRecommendation.forEach(podcast => {
                    const li = document.createElement('li');
                    // 获取播客封面图片路径
                    const coverPath = getPodcastCoverPath(podcast.author);
                    // 添加播客信息
                    li.innerHTML = `
                        <img src="${coverPath}" alt="${podcast.author}" class="podcast-thumbnail">
                        <div class="podcast-info">
                            <span class="podcast-title">${podcast.title}</span>
                            <span class="podcast-duration">(${podcast.duration} 分钟)</span>
                            <div class="summary" style="margin-top: 5px;">${podcast.description}</div>
                        </div>
                        <div class="podcast-actions">
                            <button class="control-button" onclick="event.stopPropagation(); playPodcast(currentRecommendation[${currentRecommendation.indexOf(podcast)}]);"><i class="fas fa-play"></i></button>
                            <button class="control-button" onclick="event.stopPropagation(); addToPlaylist(${currentRecommendation.indexOf(podcast)});"><i class="fas fa-plus"></i></button>
                        </div>
                    `;
                    // 修改点击事件为跳转到详情页
                    li.style.cursor = 'pointer';
                    li.addEventListener('click', () => {
                        // 传递播客ID到详情页
                        window.location.href = `detail.html?id=${podcast.id}`;
                    });
                    resultList.appendChild(li);
                });
                confirmButton.style.display = 'inline-block';
                
                // 显示总时长
                const totalDuration = currentRecommendation.reduce((sum, podcast) => sum + podcast.duration, 0);
                const durationDiff = Math.abs(totalDuration - targetDuration);
                let matchText = '';
                
                if (durationDiff <= 5) {
                    matchText = `<span style="color: #4CAF50;">✓ 完美匹配您的时长需求</span>`;
                } else if (durationDiff <= 15) {
                    matchText = `<span style="color: #FF9800;">接近您的时长需求</span>`;
                } else {
                    matchText = `<span style="color: #F44336;">与您的时长需求相差 ${durationDiff} 分钟</span>`;
                }
                
                const summaryLi = document.createElement('li');
                summaryLi.style.backgroundColor = 'rgba(142, 68, 173, 0.05)';
                summaryLi.style.borderLeft = '3px solid var(--primary-color)';
                summaryLi.innerHTML = `
                    <div style="width: 100%; text-align: center;">
                        <div>总时长: <b>${totalDuration}</b> 分钟</div>
                        <div style="font-size: 0.85rem; margin-top: 5px;">${matchText}</div>
                    </div>
                `;
                resultList.appendChild(summaryLi);
                
            } else {
                resultList.innerHTML = '<li>未能找到合适的播客推荐。</li>';
                confirmButton.style.display = 'none';
            }
            }, 800); // 模拟延迟结束
        }

        // 加入待播列表
        function addToPlaylist(index) {
            // 如果提供了索引，则只添加该索引对应的播客
            if (index !== undefined && index >= 0 && index < currentRecommendation.length) {
                playlist.push(currentRecommendation[index]);
                renderPlaylist();
                // 更新按钮状态
                const button = event.target.closest('button');
                if (button) {
                    const icon = button.querySelector('i');
                    if (icon) {
                        icon.classList.remove('fa-plus');
                        icon.classList.add('fa-check');
                    }
                    button.classList.add('added');
                    // 2秒后恢复原状态
                    setTimeout(() => {
                        if (icon) {
                            icon.classList.remove('fa-check');
                            icon.classList.add('fa-plus');
                        }
                        button.classList.remove('added');
                    }, 2000);
                }
            } 
            // 如果没有提供索引，则添加所有推荐
            else if (currentRecommendation.length > 0) {
                playlist.push(...currentRecommendation);
                renderPlaylist();
                // 清空推荐区并隐藏确认按钮
                document.getElementById('recommendation-result').querySelector('ul').innerHTML = '';
                document.getElementById('confirm-recommendation').style.display = 'none';
                currentRecommendation = [];
            }
        }
        
        // 渲染播放列表
        function renderPlaylist() {
            const playlistContainer = document.getElementById('playlist');
            if (!playlistContainer) {
                // 如果播放列表容器不存在，创建一个
                const moduleDiv = document.createElement('div');
                moduleDiv.className = 'module';
                moduleDiv.innerHTML = `
                    <h3>待播列表 <i class="fas fa-headphones"></i></h3>
                    <div id="playlist">
                        <ul></ul>
                    </div>
                `;
                document.querySelector('.container').appendChild(moduleDiv);
            }
            
            const playlistElement = document.getElementById('playlist') || playlistContainer;
            const playlistUl = playlistElement.querySelector('ul');
            playlistUl.innerHTML = '';
            
            if (playlist.length === 0) {
                playlistUl.innerHTML = '<li style="justify-content: center; color: var(--text-muted-color);">待播列表为空，请添加播客</li>';
                return;
            }
            
            playlist.forEach((podcast, index) => {
                const li = document.createElement('li');
                // 获取播客封面图片路径
                const coverPath = getPodcastCoverPath(podcast.author);
                li.innerHTML = `
                    <img src="${coverPath}" alt="${podcast.author}" class="podcast-thumbnail">
                    <div class="podcast-info">
                        <span class="podcast-title">${podcast.title}</span>
                        <span class="podcast-duration">(${podcast.duration} 分钟)</span>
                        <div class="summary" style="margin-top: 5px;">${podcast.description}</div>
                    </div>
                    <div>
                        <button class="control-button play-pause" style="margin-right: 10px;" onclick="event.stopPropagation(); playPodcast(playlist[${index}]);"><i class="fas fa-play"></i></button>
                        <button class="secondary" onclick="event.stopPropagation(); removeFromPlaylist(${index})"><i class="fas fa-times"></i></button>
                    </div>
                `;
                // 添加点击播放功能
                li.style.cursor = 'pointer';
                li.addEventListener('click', () => playPodcast(podcast));
                playlistUl.appendChild(li);
            });
            
            // 显示总时长
            const totalDuration = playlist.reduce((sum, podcast) => sum + podcast.duration, 0);
            const summaryLi = document.createElement('li');
            summaryLi.style.backgroundColor = 'rgba(142, 68, 173, 0.05)';
            summaryLi.style.borderLeft = '3px solid var(--primary-color)';
            summaryLi.innerHTML = `
                <div style="width: 100%; text-align: center;">
                    <div>总时长: <b>${totalDuration}</b> 分钟</div>
                </div>
            `;
            playlistUl.appendChild(summaryLi);
        }
        
        // 从播放列表中移除
        function removeFromPlaylist(index) {
            playlist.splice(index, 1);
            renderPlaylist();
        }

       

        // 播放播客
        function playPodcast(podcast) {
            // 创建播放器容器（如果不存在）
            if (!document.querySelector('.player-container')) {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player-container';
                playerDiv.innerHTML = `
                    <div class="player-content">
                        <div class="now-playing">
                            <div class="podcast-cover" id="current-podcast-cover"></div>
                            <div class="player-title" id="current-podcast-title"></div>
                            <div class="player-author" id="current-podcast-author"></div>
                        </div>
                        <div class="player-controls">
                            <button class="control-button"><i class="fas fa-step-backward"></i></button>
                            <button class="control-button play-pause"><i class="fas fa-play"></i></button>
                            <button class="control-button"><i class="fas fa-step-forward"></i></button>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill"></div>
                            </div>
                            <div class="time-display">
                                <span id="current-time">0:00</span>
                                <span id="total-time">0:00</span>
                            </div>
                        </div>
                    </div>
                `;
                
                // 将播放器插入到问候栏下方
                const greetingBar = document.querySelector('.greeting-bar');
                greetingBar.parentNode.insertBefore(playerDiv, greetingBar.nextSibling);
            }
            
            // 旧播放器UI更新逻辑已移除
            console.log("旧播放器UI更新逻辑已移除，播放状态由详情页处理");
        }
        
        // 更新问候语和当前时间
        function updateGreeting() {
            const now = new Date();
            const hour = now.getHours();
            let greeting = "";
            
            if (hour >= 5 && hour < 12) {
                greeting = "早上好";
            } else if (hour >= 12 && hour < 14) {
                greeting = "中午好";
            } else if (hour >= 14 && hour < 18) {
                greeting = "下午好";
            } else if (hour >= 18 && hour < 22) {
                greeting = "晚上好";
            } else {
                greeting = "夜深了";
            }
            
            document.getElementById('greeting').textContent = `${greeting}，选择你的收听时长，开启定制推荐`;
            
            // 更新时间显示
            const timeStr = now.toLocaleTimeString('zh-CN', {hour: '2-digit', minute:'2-digit'});
            document.getElementById('current-time').textContent = timeStr;
            
            // 每分钟更新一次
            setTimeout(updateGreeting, 60000);
        }
        
        // 滑块选择器功能
        function initSlider() {
            const slider = document.getElementById('listen-duration-slider');
            const durationValue = document.getElementById('duration-value');
            
            // 初始化显示
            durationValue.textContent = slider.value;
            
            // 关键节点值
            const keyPoints = [0, 30, 60, 90, 120];
            
            // 监听滑块变化
            slider.addEventListener('input', function() {
                let value = parseInt(this.value);
                durationValue.textContent = value;
            });
            
            // 添加滑块释放事件，实现节点吸附功能
            slider.addEventListener('change', function() {
                let value = parseInt(this.value);
                
                // 查找最近的关键节点
                let closest = keyPoints.reduce((prev, curr) => {
                    return (Math.abs(curr - value) < Math.abs(prev - value) ? curr : prev);
                });
                
                // 如果当前值与关键节点的差距小于10，则吸附到关键节点
                if (Math.abs(value - closest) <= 10) {
                    this.value = closest;
                    durationValue.textContent = closest;
                }
            });
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            updateGreeting(); // 更新问候语
            initSlider();     // 初始化滑块
        });

    </script>
    <script>
        const listenDurationSlider = document.getElementById('listen-duration-slider');
        const durationValueSpan = document.getElementById('duration-value');
        const recommendationResultUl = document.getElementById('recommendation-result').querySelector('ul');
        const greetingElement = document.getElementById('greeting');
        const currentTimeElement = document.getElementById('current-time');
        const playlistUl = document.getElementById('playlist')?.querySelector('ul'); // 获取待播列表ul, 注意: 需要在HTML中添加id为playlist的元素

        // --- 全局变量 ---
        let audio = new Audio();
        let currentPodcast = null;
        let playlist = [];

       

        // 更新滑块显示的值
        listenDurationSlider.addEventListener('input', () => {
            durationValueSpan.textContent = listenDurationSlider.value;
        });

        // 更新问候语和时间
        function updateGreetingAndTime() {
            const now = new Date();
            const hours = now.getHours();
            let greeting = "";
            if (hours < 6) {
                greeting = "凌晨好！";
            } else if (hours < 12) {
                greeting = "早上好！";
            } else if (hours < 14) {
                greeting = "中午好！";
            } else if (hours < 18) {
                greeting = "下午好！";
            } else {
                greeting = "晚上好！";
            }
            // 保留原有的问候语部分，只更新时间相关的提示
            // greetingElement.textContent = `${greeting}选择你的收听时长，开启定制推荐`; 

            const minutes = now.getMinutes().toString().padStart(2, '0');
            currentTimeElement.textContent = `${hours}:${minutes}`;
        }

        // 生成播客列表项 HTML
        function createPodcastListItem(podcast) {
            const isPlaying = currentPodcast && currentPodcast.id === podcast.id && audio && !audio.paused;
            const isInPlaylist = playlist.some(p => p.id === podcast.id);
            return `
                <li data-id="${podcast.id}">
                    <img src="${podcast.cover}" alt="${podcast.title}" class="podcast-thumbnail">
                    <div class="podcast-info">
                        <span class="podcast-title">${podcast.title}</span>
                        <span class="podcast-duration">时长: ${podcast.duration}分钟</span>
                        <p class="summary">${podcast.summary}</p>
                    </div>
                    <div class="podcast-actions">
                        <button class="control-button play-item ${isPlaying ? 'playing' : ''}" onclick="togglePlayRecommended(${podcast.id}, this)">
                            <i class="fas ${isPlaying ? 'fa-pause' : 'fa-play'}"></i>
                        </button>
                        <button class="control-button add-playlist ${isInPlaylist ? 'added' : ''}" onclick="togglePlaylistItem(${podcast.id}, this)">
                            <i class="fas ${isInPlaylist ? 'fa-check' : 'fa-plus'}"></i>
                        </button>
                    </div>
                </li>
            `;
        }

        // 获取推荐播客
        function getRecommendations(isButtonClicked = false) {
            let recommendedPodcasts = [];
            const selectedDuration = parseInt(listenDurationSlider.value);

            if (isButtonClicked) {
                // 根据选择的时长推荐 (简单示例：时长接近的)
                recommendedPodcasts = allPodcasts.filter(p => Math.abs(p.duration - selectedDuration) <= 15).slice(0, 3);
                // 如果筛选后不够3个，可以补充一些其他的
                if (recommendedPodcasts.length < 3) {
                    const otherPodcasts = allPodcasts.filter(p => !recommendedPodcasts.some(rp => rp.id === p.id));
                    recommendedPodcasts = recommendedPodcasts.concat(otherPodcasts.slice(0, 3 - recommendedPodcasts.length));
                }
                 console.log(`根据时长 ${selectedDuration} 分钟推荐`);
            } else {
                // 随机推荐3个 (初始加载)
                const shuffled = [...allPodcasts].sort(() => 0.5 - Math.random());
                recommendedPodcasts = shuffled.slice(0, 3);
                console.log("初始随机推荐");
            }

            // 更新推荐列表
            recommendationResultUl.innerHTML = recommendedPodcasts.map(createPodcastListItem).join('');
        }

        // 播放指定播客
        function playPodcast(podcast) {
            if (!podcast) return;
            
            // 如果当前有音频在播放，并且不是同一个播客，先暂停旧的
            if (currentPodcast && currentPodcast.id !== podcast.id && !audio.paused) {
                audio.pause();
            }
            
            console.log(`尝试播放: ${podcast.title}`);
            currentPodcast = podcast;
            // **重要：这里需要真实的音频URL。当前使用封面图URL作为占位符**
            // 实际应用中，podcast对象应包含 audioUrl 字段
            const audioUrl = podcast.audioUrl || podcast.cover; // 优先使用 audioUrl
            if (audio.src !== audioUrl) { // 只有在源不同时才重新加载
                 audio.src = audioUrl; 
            }
           
            audio.play().catch(e => {
                console.error(`音频播放错误 for ${podcast.title}:`, e);
                // 可以在这里添加用户反馈，例如提示播放失败
                currentPodcast = null; // 播放失败，重置当前播客
                updatePlayPauseButtons();
            });

            // 更新主播放器UI (如果存在)
            const playerContainer = document.querySelector('.player-container');
            if (playerContainer) {
                const playerTitle = playerContainer.querySelector('.player-title');
                const playerAuthor = playerContainer.querySelector('.player-author');
                const playerCover = playerContainer.querySelector('.podcast-cover');
                if(playerTitle) playerTitle.textContent = podcast.title;
                if(playerAuthor) playerAuthor.textContent = `时长: ${podcast.duration}分钟`;
                if(playerCover) playerCover.style.backgroundImage = `url('${podcast.cover}')`;
                // 可以在这里添加显示播放器的逻辑（如果默认隐藏）
                playerContainer.style.display = 'block'; 
            } else {
                console.warn("未找到主播放器容器 '.player-container'，无法更新UI。")
            }
            
            updatePlayPauseButtons(); // 更新所有按钮状态
        }

        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', () => {
            updateGreetingAndTime();
            setInterval(updateGreetingAndTime, 60000); // 每分钟更新时间
            getRecommendations(false); // 初始加载随机推荐
        });

        // --- 新增：播放/暂停推荐列表中的播客 ---
        function togglePlayRecommended(podcastId, button) {
            const podcast = allPodcasts.find(p => p.id === podcastId);
            if (!podcast) return;

            // 如果点击的是当前正在播放的播客
            if (currentPodcast && currentPodcast.id === podcastId) {
                if (audio.paused) {
                    audio.play().catch(e => console.error("音频播放错误:", e));
                } else {
                    audio.pause();
                }
            } else {
                // 播放新的播客
                playPodcast(podcast);
            }
            updatePlayPauseButtons(); // 更新所有相关按钮状态
        }

        // --- 新增：切换播客在待播列表中的状态 ---
        function togglePlaylistItem(podcastId, button) {
            const podcastIndex = playlist.findIndex(p => p.id === podcastId);
            const icon = button.querySelector('i');

            if (podcastIndex > -1) {
                // 从列表中移除
                playlist.splice(podcastIndex, 1);
                icon.classList.remove('fa-check');
                icon.classList.add('fa-plus');
                button.classList.remove('added');
                console.log(`播客 ID ${podcastId} 已从待播列表移除`);
            } else {
                // 添加到列表
                const podcastToAdd = allPodcasts.find(p => p.id === podcastId);
                if (podcastToAdd) {
                    playlist.push(podcastToAdd);
                    icon.classList.remove('fa-plus');
                    icon.classList.add('fa-check');
                    button.classList.add('added');
                    console.log(`播客 ${podcastToAdd.title} 已添加到待播列表`);
                } else {
                    console.log(`未找到 ID 为 ${podcastId} 的播客`);
                }
            }
            displayPlaylist(); // 更新待播列表显示
        }

        // --- 新增：更新所有播放/暂停按钮状态 ---
        function updatePlayPauseButtons() {
            const mainPlayPauseButton = document.querySelector('.player-container .play-pause i'); // 主播放器按钮
            const recommendationItems = document.querySelectorAll('#recommendation-result li');

            // 更新主播放器按钮状态 (如果主播放器存在)
            if (mainPlayPauseButton) {
                 if (currentPodcast && !audio.paused) {
                    mainPlayPauseButton.classList.remove('fa-play');
                    mainPlayPauseButton.classList.add('fa-pause');
                } else {
                    mainPlayPauseButton.classList.remove('fa-pause');
                    mainPlayPauseButton.classList.add('fa-play');
                }
            }

            // 更新推荐列表按钮状态
            recommendationItems.forEach(item => {
                const button = item.querySelector('.play-item');
                const icon = button?.querySelector('i');
                const itemId = parseInt(item.dataset.id);
                if (button && icon) {
                    if (currentPodcast && currentPodcast.id === itemId && !audio.paused) {
                        icon.classList.remove('fa-play');
                        icon.classList.add('fa-pause');
                        button.classList.add('playing');
                    } else {
                        icon.classList.remove('fa-pause');
                        icon.classList.add('fa-play');
                        button.classList.remove('playing');
                    }
                }
            });

            // 更新播放列表中的播放按钮状态 (如果播放列表和按钮存在)
            const playlistItems = document.querySelectorAll('#playlist li');
            playlistItems.forEach(item => {
                const button = item.querySelector('.play-item'); // 假设播放列表项也有 play-item 按钮
                const icon = button?.querySelector('i');
                const itemId = parseInt(item.dataset.id);
                 if (button && icon) {
                    if (currentPodcast && currentPodcast.id === itemId && !audio.paused) {
                        icon.classList.remove('fa-play');
                        icon.classList.add('fa-pause');
                        button.classList.add('playing');
                    } else {
                        icon.classList.remove('fa-pause');
                        icon.classList.add('fa-play');
                        button.classList.remove('playing');
                    }
                }
            });
        }

        // --- 新增：显示待播列表 ---
        function displayPlaylist() {
            if (!playlistUl) {
                console.warn("未找到ID为 'playlist' 的待播列表容器。");
                return; 
            }
            playlistUl.innerHTML = ''; // 清空
            if (playlist.length === 0) {
                playlistUl.innerHTML = '<li>待播列表为空</li>';
                return;
            }
            playlist.forEach((podcast, index) => {
                const listItem = document.createElement('li');
                listItem.dataset.id = podcast.id;
                const isPlaying = currentPodcast && currentPodcast.id === podcast.id && !audio.paused;
                // 注意：播放列表项的HTML结构可能需要调整以匹配推荐列表项
                listItem.innerHTML = `
                    <img src="${podcast.cover}" alt="${podcast.title}" class="podcast-thumbnail">
                    <div class="podcast-info">
                        <span class="podcast-title">${index + 1}. ${podcast.title}</span>
                        <span class="podcast-duration">时长: ${podcast.duration}分钟</span>
                    </div>
                    <div class="podcast-actions">
                         <button class="control-button play-item ${isPlaying ? 'playing' : ''}" onclick="togglePlayRecommended(${podcast.id}, this)"> <i class="fas ${isPlaying ? 'fa-pause' : 'fa-play'}"></i></button>
                         <button class="control-button secondary" onclick="removeFromPlaylist(${index})"><i class="fas fa-times"></i></button>
                    </div>
                `;
                playlistUl.appendChild(listItem);
            });
        }
        
        // --- 新增：从播放列表移除 ---
        function removeFromPlaylist(index) {
            if (index >= 0 && index < playlist.length) {
                const removedPodcast = playlist.splice(index, 1)[0];
                console.log(`从待播列表移除: ${removedPodcast.title}`);
                displayPlaylist(); // 更新列表显示
                // 更新推荐列表中对应项的添加按钮状态
                const recommendationButton = document.querySelector(`#recommendation-result li[data-id="${removedPodcast.id}"] .add-playlist`);
                if (recommendationButton) {
                    recommendationButton.classList.remove('added');
                    recommendationButton.querySelector('i').classList.remove('fa-check');
                    recommendationButton.querySelector('i').classList.add('fa-plus');
                }
            }
        }
        
        // --- 事件监听 ---
        audio.addEventListener('play', () => updatePlayPauseButtons());
        audio.addEventListener('pause', () => updatePlayPauseButtons());
        audio.addEventListener('ended', () => {
            console.log('播放结束');
            const currentIndex = playlist.findIndex(p => p.id === currentPodcast?.id);
            currentPodcast = null; // 清除当前播放状态
            updatePlayPauseButtons();
            // 自动播放下一首 (如果当前是从播放列表播放的)
            if (currentIndex > -1 && currentIndex < playlist.length - 1) {
                 playPodcast(playlist[currentIndex + 1]);
            } else {
                 // 如果是最后一首或不是从播放列表播放的，则停止
                 console.log("播放列表结束或非列表播放结束");
            }
        });
        // 初始化时显示待播列表（如果存在）
        document.addEventListener('DOMContentLoaded', displayPlaylist);

    </script>
</body>
</html>