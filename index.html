<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>喜马拉雅FM - 随心听</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap'); /* 引入现代字体 */

        :root {
            --primary-color: #8e44ad; /* 主题色 - 紫色 */
            --primary-light: #a569bd; /* 浅紫色 */
            --primary-dark: #703688; /* 深紫色 */
            --secondary-color: #9b59b6; /* 次要色 - 淡紫色 */
            --background-color: #f5f5f7; /* 背景色 - 浅灰偏白 */
            --surface-color: #ffffff; /* 元素表面色 - 白色 */
            --text-color: #333333; /* 主要文本色 - 深灰 */
            --text-muted-color: #777777; /* 次要文本色 - 灰色 */
            --border-color: #e0e0e0; /* 边框色 - 浅灰 */
            --hover-bg-color: #f0f0f2; /* 悬停背景色 */
            --button-hover-bg: #7d3c98; /* 按钮悬停背景色 */
            --box-shadow: 0 4px 20px rgba(142, 68, 173, 0.1); /* 紫色调阴影 */
            --border-radius: 12px; /* 更大的圆角 */
            --transition-speed: 0.3s; /* 统一过渡动画速度 */
        }

        body {
            font-family: 'Inter', sans-serif; /* 应用新字体 */
            margin: 0;
            padding: 0; /* 移除页面边距 */
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        .container {
            max-width: 100%;
            margin: auto;
            background: var(--surface-color);
            padding: 20px; /* 减少容器内边距 */
            border-radius: 0; /* 移除顶部圆角 */
            box-shadow: var(--box-shadow);
        }
        
        /* 顶部问候栏样式 */
        .greeting-bar {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: white;
            padding: 15px 20px;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            margin: -20px -20px 20px -20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .greeting-text {
            font-size: 1.1rem;
            font-weight: 500;
        }
        .current-time {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        /* 播放器样式 */
        .player-container {
            background: linear-gradient(135deg, var(--primary-light), var(--primary-color));
            border-radius: var(--border-radius);
            padding: 25px 20px;
            color: white;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(142, 68, 173, 0.2);
            transition: transform var(--transition-speed), box-shadow var(--transition-speed);
        }
        
        .player-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(142, 68, 173, 0.25);
        }
        .player-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('https://source.unsplash.com/random/800x400/?music') center/cover no-repeat;
            opacity: 0.2;
            z-index: 0;
        }
        .player-content {
            position: relative;
            z-index: 1;
        }
        .now-playing {
            text-align: center;
            margin-bottom: 20px;
        }
        .podcast-cover {
            width: 180px;
            height: 180px;
            border-radius: 10px;
            margin: 0 auto 15px;
            display: block;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            background-color: rgba(255, 255, 255, 0.1);
            background-size: cover;
            background-position: center;
            transition: transform var(--transition-speed), box-shadow var(--transition-speed);
            position: relative;
            overflow: hidden;
        }
        
        .podcast-cover::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 50%);
            pointer-events: none;
        }
        
        .podcast-cover:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.4);
        }
        .player-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        .player-author {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        .player-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }
        .control-button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 10px;
            cursor: pointer;
            transition: all var(--transition-speed);
            color: white;
            font-size: 1rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .control-button.play-pause {
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
            background: white;
            color: var(--primary-color);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }
        .control-button:hover {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.3);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }
        .control-button.play-pause:hover {
            background: white;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        .control-button:active {
            transform: scale(0.95);
        }
        .progress-container {
            margin-bottom: 10px;
        }
        .progress-bar {
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            position: relative;
            cursor: pointer;
            overflow: hidden;
            transition: height 0.2s;
        }
        .progress-bar:hover {
            height: 6px;
        }
        .progress-fill {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: white;
            border-radius: 2px;
            width: 0%; /* 初始进度 */
            transition: width 0.1s linear;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        .time-display {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            margin-top: 5px;
            opacity: 0.9;
        }
        
        /* 滑块选择器样式 */
        .slider-container {
            margin-bottom: 25px;
        }
        .slider-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--primary-color);
        }
        .range-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--border-color);
            outline: none;
            margin-bottom: 10px;
        }
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            transition: all var(--transition-speed);
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
        }
        .range-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            background: var(--primary-dark);
            box-shadow: 0 0 10px rgba(142, 68, 173, 0.4);
        }
        .slider-value {
            text-align: center;
            font-weight: 500;
            color: var(--primary-color);
        }
        h1 {
            color: var(--text-color);
            text-align: center;
            margin-bottom: 40px; /* 增加标题下边距 */
            font-weight: 700;
        }
        h2, h3, h4 {
            color: var(--text-color);
            margin-top: 0;
            font-weight: 500;
        }
        .module {
            margin-bottom: 35px; /* 增加模块间距 */
            padding: 20px; /* 增加模块内边距 */
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: var(--surface-color); /* 模块背景 */
        }
        .module h3 {
            color: var(--primary-color); /* 模块标题使用主题色 */
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 20px; /* 增加标题下边距 */
        }
        label {
            display: block;
            margin-bottom: 8px; /* 增加标签下边距 */
            font-weight: 500;
            color: var(--text-muted-color);
        }
        input[type="number"] {
            width: 120px; /* 稍微加宽 */
            padding: 10px 12px; /* 增加内边距 */
            margin-bottom: 15px; /* 增加下边距 */
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            box-sizing: border-box; /* 确保 padding 不影响宽度 */
        }
        input[type="number"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }
        button {
            padding: 10px 20px; /* 调整按钮内边距 */
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            margin-right: 8px;
            font-size: 0.95rem;
            transition: all var(--transition-speed);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        button:hover {
            background-color: var(--button-hover-bg);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        button:active {
            transform: translateY(0);
        }
        button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%, -50%);
            transform-origin: 50% 50%;
        }
        button:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }
        /* 次要按钮样式 (例如移除按钮) */
        button.secondary {
            background-color: var(--surface-color);
            color: var(--secondary-color);
            border: 1px solid var(--border-color);
        }
        button.secondary:hover {
            background-color: var(--hover-bg-color);
            border-color: var(--secondary-color);
        }

        #recommendation-result ul, #playlist ul, #recently-listened ul {
            list-style: none;
            padding: 0;
            margin-top: 15px; /* 列表与上方元素间距 */
        }
        #recommendation-result li, #playlist li, #recently-listened li {
            background: var(--surface-color);
            margin-bottom: 12px; /* 列表项间距 */
            padding: 15px; /* 列表项内边距 */
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all var(--transition-speed);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        #recommendation-result li:hover, #playlist li:hover, #recently-listened li:hover {
            background-color: var(--hover-bg-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-color: var(--primary-light);
        }
        /* 已经在上面的样式中更新了这部分 */
        .podcast-info {
            flex-grow: 1;
            margin-right: 15px; /* 信息与按钮间距 */
        }
        .podcast-title {
            font-weight: 500; /* 调整字重 */
            color: var(--text-color);
            display: block; /* 让标题独占一行 */
            margin-bottom: 4px;
        }
        .podcast-duration {
            color: var(--text-muted-color);
            font-size: 0.85em;
        }
        .listen-progress {
            font-size: 0.85em;
            color: var(--primary-color);
            margin-top: 5px;
        }
        .summary {
            font-size: 0.8em;
            color: var(--text-muted-color);
            margin-top: 8px;
            line-height: 1.4;
        }
        .summary b {
            color: var(--text-color);
            font-weight: 500;
        }
        /* 隐藏推荐确认按钮的初始样式 */
        #confirm-recommendation {
             margin-top: 15px; /* 与列表的间距 */
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 顶部问候栏 -->
        <div class="greeting-bar">
            <div class="greeting-text" id="greeting">下午好，欢迎来到随心听FM</div>
            <div class="current-time" id="current-time">15:30</div>
        </div>
        
        <h1>喜马拉雅 · 随心听</h1>
        
        <!-- 播放器界面 -->
        <div class="player-container">
            <div class="player-content">
                <div class="now-playing">
                    <div class="podcast-cover" id="current-cover" style="background-image: url('https://source.unsplash.com/random/400x400/?podcast')"></div>
                    <div class="player-title" id="current-title">正在加载...</div>
                    <div class="player-author" id="current-author">喜马拉雅FM</div>
                </div>
                
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div class="time-display">
                        <span id="current-time-display">00:00</span>
                        <span id="total-time-display">00:00</span>
                    </div>
                </div>
                
                <div class="player-controls">
                    <button class="control-button" id="prev-button"><i class="fas fa-step-backward"></i></button>
                    <button class="control-button play-pause" id="play-pause-button"><i class="fas fa-play" id="play-icon"></i></button>
                    <button class="control-button" id="next-button"><i class="fas fa-step-forward"></i></button>
                </div>
            </div>
        </div>
        
        <!-- 收听时长滑块 -->
        <div class="slider-container">
            <label class="slider-label" for="listen-duration-slider">预计收听时长: <span id="duration-value">60</span> 分钟</label>
            <input type="range" class="range-slider" id="listen-duration-slider" min="5" max="120" value="60" step="5">
        </div>

        <!-- 个性化推荐模块 -->
        <div class="module">
            <h3>为您推荐 <i class="fas fa-magic"></i></h3>
            <div style="margin-bottom: 15px;">
                <button onclick="getRecommendations()" class="refresh-button"><i class="fas fa-sync-alt"></i> 刷新推荐</button>
                <span class="recommendation-tip" style="font-size: 0.85rem; color: var(--text-muted-color); margin-left: 10px;">根据您设置的时长智能推荐</span>
            </div>

            <div id="recommendation-result">
                <ul>
                    <!-- 推荐结果将显示在这里 -->
                </ul>
                <button onclick="addToPlaylist()" style="display: none;" id="confirm-recommendation">加入待播</button>
            </div>
        </div>

        <!-- 待播列表模块 -->
        <div class="module">
            <h3>待播列表 <i class="fas fa-list"></i></h3>
            <ul id="playlist">
                <!-- 待播节目将显示在这里 -->
            </ul>
        </div>

        <!-- 最近收听模块 -->
        <div class="module">
            <h3>最近收听 <i class="fas fa-history"></i></h3>
            <ul id="recently-listened">
                <!-- 最近收听节目将显示在这里 -->
            </ul>
        </div>
    </div>

    <script>
        // 模拟播客数据
        const allPodcasts = [
            { id: 1, title: "科技早知道", duration: 15, description: "每日科技资讯解读" },
            { id: 2, title: "历史故事会", duration: 30, description: "深入浅出的历史趣闻" },
            { id: 3, title: "轻松学英语", duration: 20, description: "日常口语练习" },
            { id: 4, title: "商业评论", duration: 45, description: "深度分析商业模式" },
            { id: 5, title: "电影爱好者", duration: 60, description: "最新电影评论与推荐" },
            { id: 6, title: "健康生活谈", duration: 25, description: "养生与健康小贴士" },
            { id: 7, title: "环球旅行记", duration: 50, description: "分享世界各地的旅行见闻" },
            { id: 8, title: "音乐下午茶", duration: 40, description: "精选放松音乐与故事" }
        ];

        // 模拟最近收听数据 (包含收听进度)
        const recentlyListenedData = [
            { id: 2, title: "历史故事会", duration: 30, listened: 10, listenedSummary: "回顾了明朝的建立过程。", remainingSummary: "接下来将探讨清朝的崛起。" },
            { id: 4, title: "商业评论", duration: 45, listened: 30, listenedSummary: "分析了互联网公司的盈利模式。", remainingSummary: "剩余部分将讨论未来趋势。" }
        ];

        let currentRecommendation = [];
        let playlist = [];

        // 获取推荐组合
        function getRecommendations() {
            const targetDuration = parseInt(document.getElementById('duration-value').textContent);
            const resultList = document.getElementById('recommendation-result').querySelector('ul');
            const confirmButton = document.getElementById('confirm-recommendation');
            resultList.innerHTML = ''; // 清空旧推荐
            currentRecommendation = [];
            
            // 添加加载动画
            resultList.innerHTML = '<li style="justify-content: center;"><i class="fas fa-spinner fa-spin" style="margin-right: 10px;"></i> 正在为您推荐...</li>';
            
            // 模拟网络延迟
            setTimeout(() => {
                resultList.innerHTML = '';
                
                if (isNaN(targetDuration) || targetDuration <= 0) {
                    resultList.innerHTML = '<li>请输入有效的时长。</li>';
                    confirmButton.style.display = 'none';
                    return;
                }

            // 简单的推荐逻辑：找到时长最接近的单个或两个节目组合
            // 优先单个节目
            let bestSingleMatch = null;
            let minSingleDiff = Infinity;

            allPodcasts.forEach(p => {
                const diff = Math.abs(p.duration - targetDuration);
                if (diff < minSingleDiff) {
                    minSingleDiff = diff;
                    bestSingleMatch = p;
                }
            });

            // 尝试两个节目组合
            let bestPairMatch = [];
            let minPairDiff = Infinity;

            for (let i = 0; i < allPodcasts.length; i++) {
                for (let j = i + 1; j < allPodcasts.length; j++) {
                    const pairDuration = allPodcasts[i].duration + allPodcasts[j].duration;
                    const diff = Math.abs(pairDuration - targetDuration);
                    if (diff < minPairDiff) {
                        minPairDiff = diff;
                        bestPairMatch = [allPodcasts[i], allPodcasts[j]];
                    }
                }
            }

            // 比较单节目和双节目组合哪个更优 (优先时长更接近的)
            if (bestSingleMatch && minSingleDiff <= minPairDiff + 5) { // 给单节目一点容忍度
                 currentRecommendation = [bestSingleMatch];
            } else if (bestPairMatch.length > 0) {
                 currentRecommendation = bestPairMatch;
            }

            if (currentRecommendation.length > 0) {
                currentRecommendation.forEach(podcast => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <div class="podcast-info">
                            <span class="podcast-title">${podcast.title}</span>
                            <span class="podcast-duration">(${podcast.duration} 分钟)</span>
                            <div class="summary" style="margin-top: 5px;">${podcast.description}</div>
                        </div>
                    `;
                    resultList.appendChild(li);
                });
                confirmButton.style.display = 'inline-block';
                
                // 显示总时长
                const totalDuration = currentRecommendation.reduce((sum, podcast) => sum + podcast.duration, 0);
                const durationDiff = Math.abs(totalDuration - targetDuration);
                let matchText = '';
                
                if (durationDiff <= 5) {
                    matchText = `<span style="color: #4CAF50;">✓ 完美匹配您的时长需求</span>`;
                } else if (durationDiff <= 15) {
                    matchText = `<span style="color: #FF9800;">接近您的时长需求</span>`;
                } else {
                    matchText = `<span style="color: #F44336;">与您的时长需求相差 ${durationDiff} 分钟</span>`;
                }
                
                const summaryLi = document.createElement('li');
                summaryLi.style.backgroundColor = 'rgba(142, 68, 173, 0.05)';
                summaryLi.style.borderLeft = '3px solid var(--primary-color)';
                summaryLi.innerHTML = `
                    <div style="width: 100%; text-align: center;">
                        <div>总时长: <b>${totalDuration}</b> 分钟</div>
                        <div style="font-size: 0.85rem; margin-top: 5px;">${matchText}</div>
                    </div>
                `;
                resultList.appendChild(summaryLi);
                
            } else {
                resultList.innerHTML = '<li>未能找到合适的播客推荐。</li>';
                confirmButton.style.display = 'none';
            }
            }, 800); // 模拟延迟结束
        }

        // 加入待播列表
        function addToPlaylist() {
            if (currentRecommendation.length > 0) {
                playlist.push(...currentRecommendation);
                renderPlaylist();
                // 清空推荐区并隐藏确认按钮
                document.getElementById('recommendation-result').querySelector('ul').innerHTML = '';
                document.getElementById('confirm-recommendation').style.display = 'none';
                currentRecommendation = [];
            }
        }

        // 渲染待播列表
        function renderPlaylist() {
            const playlistUl = document.getElementById('playlist');
            playlistUl.innerHTML = '';
            playlist.forEach((podcast, index) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <div class="podcast-info">
                        <span class="podcast-title">${podcast.title}</span>
                        <span class="podcast-duration">(${podcast.duration} 分钟)</span>
                    </div>
                    <button onclick="removeFromPlaylist(${index})" class="secondary">移除</button>
                `;
                playlistUl.appendChild(li);
            });
        }

        // 从待播列表移除
        function removeFromPlaylist(index) {
            playlist.splice(index, 1);
            renderPlaylist();
        }

        // 渲染最近收听列表
        function renderRecentlyListened() {
            const recentlyListenedUl = document.getElementById('recently-listened');
            recentlyListenedUl.innerHTML = '';
            recentlyListenedData.forEach(podcast => {
                const li = document.createElement('li');
                const progress = Math.round((podcast.listened / podcast.duration) * 100);
                li.innerHTML = `
                    <div class="podcast-info">
                        <span class="podcast-title">${podcast.title}</span>
                        <span class="podcast-duration">(${podcast.duration} 分钟)</span>
                        <div class="listen-progress">已收听: ${podcast.listened}分钟 (${progress}%)</div>
                        <div class="summary"><b>已听回顾:</b> ${podcast.listenedSummary}</div>
                        <div class="summary"><b>剩余内容:</b> ${podcast.remainingSummary}</div>
                    </div>
                    <button onclick="continueListening(${podcast.id})">继续收听</button>
                `;
                recentlyListenedUl.appendChild(li);
            });
        }

        // 模拟继续收听功能
        function continueListening(podcastId) {
            alert(`继续收听 ID 为 ${podcastId} 的播客... (功能待实现)`);
            // 在实际应用中，这里会跳转到播放器并从上次停止的地方开始
        }

        // 更新问候语和当前时间
        function updateGreeting() {
            const now = new Date();
            const hour = now.getHours();
            let greeting = "";
            
            if (hour >= 5 && hour < 12) {
                greeting = "早上好";
            } else if (hour >= 12 && hour < 14) {
                greeting = "中午好";
            } else if (hour >= 14 && hour < 18) {
                greeting = "下午好";
            } else if (hour >= 18 && hour < 22) {
                greeting = "晚上好";
            } else {
                greeting = "夜深了";
            }
            
            document.getElementById('greeting').textContent = `${greeting}，欢迎来到随心听FM`;
            
            // 更新时间显示
            const timeStr = now.toLocaleTimeString('zh-CN', {hour: '2-digit', minute:'2-digit'});
            document.getElementById('current-time').textContent = timeStr;
            
            // 每分钟更新一次
            setTimeout(updateGreeting, 60000);
        }
        
        // 滑块选择器功能
        function initSlider() {
            const slider = document.getElementById('listen-duration-slider');
            const durationValue = document.getElementById('duration-value');
            
            // 初始化显示
            durationValue.textContent = slider.value;
            
            // 监听滑块变化
            slider.addEventListener('input', function() {
                durationValue.textContent = this.value;
            });
        }
        
        // 播放器功能
        let isPlaying = false;
        let currentPodcastIndex = -1;
        let audioTimer = null;
        
        function togglePlayPause() {
            const playIcon = document.getElementById('play-icon');
            
            if (isPlaying) {
                // 暂停
                playIcon.classList.remove('fa-pause');
                playIcon.classList.add('fa-play');
                clearInterval(audioTimer);
            } else {
                // 播放
                playIcon.classList.remove('fa-play');
                playIcon.classList.add('fa-pause');
                
                // 如果没有正在播放的播客，从待播列表中选择第一个
                if (currentPodcastIndex === -1 && playlist.length > 0) {
                    currentPodcastIndex = 0;
                    updateCurrentPodcast(playlist[currentPodcastIndex]);
                }
                
                // 模拟进度条更新
                simulateAudioProgress();
            }
            
            isPlaying = !isPlaying;
        }
        
        function simulateAudioProgress() {
            const progressFill = document.getElementById('progress-fill');
            const currentTimeDisplay = document.getElementById('current-time-display');
            const totalTimeDisplay = document.getElementById('total-time-display');
            
            // 设置总时长（假设当前播客的时长，单位为分钟）
            let totalDuration = 0;
            if (currentPodcastIndex !== -1 && playlist.length > 0) {
                totalDuration = playlist[currentPodcastIndex].duration * 60; // 转换为秒
            } else {
                totalDuration = 180; // 默认3分钟
            }
            
            // 显示总时长
            const totalMinutes = Math.floor(totalDuration / 60);
            const totalSeconds = totalDuration % 60;
            totalTimeDisplay.textContent = `${totalMinutes.toString().padStart(2, '0')}:${totalSeconds.toString().padStart(2, '0')}`;
            
            // 当前进度（秒）
            let currentProgress = 0;
            
            // 清除之前的定时器
            if (audioTimer) clearInterval(audioTimer);
            
            // 每秒更新进度
            audioTimer = setInterval(() => {
                currentProgress++;
                
                // 更新进度条
                const percentage = (currentProgress / totalDuration) * 100;
                progressFill.style.width = `${percentage}%`;
                
                // 更新当前时间显示
                const minutes = Math.floor(currentProgress / 60);
                const seconds = currentProgress % 60;
                currentTimeDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // 如果播放完毕，自动播放下一首
                if (currentProgress >= totalDuration) {
                    playNext();
                }
            }, 1000);
        }
        
        function updateCurrentPodcast(podcast) {
            document.getElementById('current-title').textContent = podcast.title;
            document.getElementById('current-author').textContent = podcast.description || '喜马拉雅FM';
            
            // 重置进度条
            document.getElementById('progress-fill').style.width = '0%';
            document.getElementById('current-time-display').textContent = '00:00';
            
            // 随机更换封面图（实际应用中应该使用真实的封面）
            const randomSeed = Math.floor(Math.random() * 1000);
            document.getElementById('current-cover').style.backgroundImage = `url('https://source.unsplash.com/random/400x400/?podcast&${randomSeed}')`;
        }
        
        function playNext() {
            // 停止当前播放
            isPlaying = false;
            togglePlayPause();
            
            // 移动到下一个播客
            if (playlist.length > 0) {
                currentPodcastIndex = (currentPodcastIndex + 1) % playlist.length;
                updateCurrentPodcast(playlist[currentPodcastIndex]);
                
                // 自动开始播放
                isPlaying = false; // 重置状态以确保正确切换
                togglePlayPause();
            }
        }
        
        function playPrevious() {
            // 停止当前播放
            isPlaying = false;
            togglePlayPause();
            
            // 移动到上一个播客
            if (playlist.length > 0) {
                currentPodcastIndex = (currentPodcastIndex - 1 + playlist.length) % playlist.length;
                updateCurrentPodcast(playlist[currentPodcastIndex]);
                
                // 自动开始播放
                isPlaying = false; // 重置状态以确保正确切换
                togglePlayPause();
            }
        }
        
        // 添加触摸滑动功能
        function initSwipeGesture() {
            const playerContainer = document.querySelector('.player-container');
            let touchStartX = 0;
            let touchEndX = 0;
            
            playerContainer.addEventListener('touchstart', (e) => {
                touchStartX = e.changedTouches[0].screenX;
            });
            
            playerContainer.addEventListener('touchend', (e) => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            });
            
            function handleSwipe() {
                const swipeThreshold = 50; // 最小滑动距离
                
                if (touchEndX - touchStartX > swipeThreshold) {
                    // 向右滑动，播放上一个
                    playPrevious();
                } else if (touchStartX - touchEndX > swipeThreshold) {
                    // 向左滑动，播放下一个
                    playNext();
                }
            }
        }
        
        // 添加键盘快捷键支持
        function initKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // 空格键 - 播放/暂停
                if (e.code === 'Space' && e.target === document.body) {
                    e.preventDefault(); // 防止页面滚动
                    togglePlayPause();
                }
                
                // 左右箭头 - 上一个/下一个
                if (e.code === 'ArrowLeft') {
                    playPrevious();
                } else if (e.code === 'ArrowRight') {
                    playNext();
                }
            });
        }
        
        // 页面加载时渲染最近收听和待播列表
        window.onload = () => {
            renderRecentlyListened();
            renderPlaylist(); // 如果有持久化存储，可以加载之前的待播列表
            updateGreeting();
            initSlider();
            initSwipeGesture();
            initKeyboardShortcuts();
            
            // 添加播放控制按钮事件监听
            document.getElementById('play-pause-button').addEventListener('click', togglePlayPause);
            document.getElementById('next-button').addEventListener('click', playNext);
            document.getElementById('prev-button').addEventListener('click', playPrevious);
            
            // 进度条点击事件
            document.querySelector('.progress-bar').addEventListener('click', function(e) {
                if (!isPlaying) return;
                
                const progressBar = this;
                const clickPosition = (e.clientX - progressBar.getBoundingClientRect().left) / progressBar.offsetWidth;
                
                // 更新进度条显示
                document.getElementById('progress-fill').style.width = `${clickPosition * 100}%`;
                
                // 在实际应用中，这里会设置音频的currentTime
                // 这里我们只是模拟更新显示
                if (currentPodcastIndex !== -1 && playlist.length > 0) {
                    const totalDuration = playlist[currentPodcastIndex].duration * 60; // 秒
                    const newProgress = Math.floor(totalDuration * clickPosition);
                    
                    // 更新时间显示
                    const minutes = Math.floor(newProgress / 60);
                    const seconds = newProgress % 60;
                    document.getElementById('current-time-display').textContent = 
                        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            });
        };

    </script>
</body>
</html>
